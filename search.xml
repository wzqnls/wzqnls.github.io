<?xml version="1.0" encoding="utf-8"?>
<search> 
  
    
    <entry>
      <title><![CDATA[scp命令用法总结]]></title>
      <url>/2017/09/17/scp%E5%91%BD%E4%BB%A4%E7%94%A8%E6%B3%95%E6%80%BB%E7%BB%93/</url>
      <content type="html"><![CDATA[<p>在linux环境下做本机的文件复制，可以使用cp命令进行操作。然而，本地服务器和远程服务器要做文件的传输复制时，cp命令就显得心有余而力不足了。这时，就引出了一个新的命令：scp。在学习这个命令之后，感受到了这个命令的强大之处。下面就将scp命令的几种常用的用法总结一下，方便以后日后查阅，也为有需要的小伙伴提供一丝帮助。</p>
<h3 id="命令参数"><a href="#命令参数" class="headerlink" title="命令参数"></a>命令参数</h3><p>在服务器上键入：<br><figure class="highlight ada"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">scp <span class="comment">--help</span></div></pre></td></tr></table></figure></p>
<p>输出：<br><figure class="highlight inform7"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">usage: scp <span class="comment">[-12346BCpqrv]</span> <span class="comment">[-c cipher]</span> <span class="comment">[-F ssh_config]</span> <span class="comment">[-i identity_file]</span></div><div class="line">           <span class="comment">[-l limit]</span> <span class="comment">[-o ssh_option]</span> <span class="comment">[-P port]</span> <span class="comment">[-S program]</span></div><div class="line">           <span class="comment">[<span class="comment">[user@]</span>host1:]</span>file1 ... <span class="comment">[<span class="comment">[user@]</span>host2:]</span>file2</div></pre></td></tr></table></figure></p>
<p>这就是scp命令的一个命令格式，针对每个参数的详细意义可以通过 man scp命令进行查阅，这里不多做赘述。</p>
<hr>
<h3 id="常用命令格式"><a href="#常用命令格式" class="headerlink" title="常用命令格式"></a>常用命令格式</h3><p><b></b></p>
<ol>
<li>scp local_file remote_username@remote_ip:remote_folder</li>
<li>scp local_file remote_username@remote_ip:remote_folder/remote_file</li>
<li>scp local_file remote_ip:remote_folder</li>
<li>scp local_file remote_ip:remote_folder/remote_file</li>
</ol>
<p>local_file:本地文件 (绝对路径或相对路径皆可)</p>
<p>remote_username:远程服务器用户名 </p>
<p>remote_ip:远程服务器ip</p>
<p>remote_file：远程服务器目标文件名（绝对路径）<br></p>
<h4 id="本地-lt-gt-远程复制"><a href="#本地-lt-gt-远程复制" class="headerlink" title="本地&lt;-&gt;远程复制"></a>本地&lt;-&gt;远程复制</h4><p>举例：<br><figure class="highlight elixir"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># 从本地复制到远程</span></div><div class="line">scp test.txt jack<span class="variable">@192</span>.<span class="number">168.1</span>.<span class="number">198</span><span class="symbol">:/home/jack/test</span></div><div class="line">scp test.txt jack<span class="variable">@192</span>.<span class="number">168.1</span>.<span class="number">198</span><span class="symbol">:/home/jack/test/test</span>.txt</div><div class="line">scp test.txt <span class="number">192.168</span>.<span class="number">1.198</span><span class="symbol">:/home/jack/test</span></div><div class="line">scp test.txt <span class="number">192.168</span>.<span class="number">1.198</span><span class="symbol">:/home/jack/test/test</span>.txt</div><div class="line"></div><div class="line"><span class="comment"># 从远程复制到本地(仅仅是路径参数调换下位置)</span></div><div class="line">scp jack<span class="variable">@192</span>.<span class="number">168.1</span>.<span class="number">198</span><span class="symbol">:/home/jack/test</span> text.txt</div><div class="line">scp jack<span class="variable">@192</span>.<span class="number">168.1</span>.<span class="number">198</span><span class="symbol">:/home/jack/test/test</span>.txt test.txt</div><div class="line">scp <span class="number">192.168</span>.<span class="number">1.198</span><span class="symbol">:/home/jack/test</span> test.txt</div><div class="line">scp <span class="number">192.168</span>.<span class="number">1.198</span><span class="symbol">:/home/jack/test/test</span>.txt test.txt</div></pre></td></tr></table></figure></p>
<p>1， 2方式需要继续键入服务器登录密码<br>3， 4方式需要键入服务器用户名和密码</p>
<h4 id="复制目录"><a href="#复制目录" class="headerlink" title="复制目录"></a>复制目录</h4><figure class="highlight elixir"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># 添加参数 -r即可，大多参数的函数与cp命令中参数含义相同</span></div><div class="line">scp -r /test jack<span class="variable">@192</span>.<span class="number">168.1</span>.<span class="number">198</span><span class="symbol">:/home/jack/test</span></div></pre></td></tr></table></figure>
<h4 id="修改远程服务器ssh端口"><a href="#修改远程服务器ssh端口" class="headerlink" title="修改远程服务器ssh端口"></a>修改远程服务器ssh端口</h4><p>在某些情况下，公司为了加强ssh通信的安全性，会对服务器的ssh默认端口22进行修改。然而，上面的命令中并没有涉及到端口的修改。下面就看看这种情况怎么处理。其实，scp早就设定了某个参数为实现自定义端口，没错就是 -P （<b>大写的P</b>）。<br><figure class="highlight elixir"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">scp -P &lt;port&gt; test.txt jack<span class="variable">@192</span>.<span class="number">168.1</span>.<span class="number">198</span><span class="symbol">:/home/jack/test</span></div></pre></td></tr></table></figure></p>
<h4 id="添加ssh公钥进行免密传输"><a href="#添加ssh公钥进行免密传输" class="headerlink" title="添加ssh公钥进行免密传输"></a>添加ssh公钥进行免密传输</h4><figure class="highlight elixir"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># 本地生成ssh密钥</span></div><div class="line"><span class="comment"># 将公钥添加至远程主机的authorized_keys中</span></div><div class="line"><span class="comment"># 1.手动复制公钥至authorized_keys中</span></div><div class="line"><span class="comment"># 2.直接将本地公钥复制到远程服务器相应目录下的authorized_keys中</span></div><div class="line">scp ~<span class="regexp">/.ssh/id</span>_rsa.pub <span class="number">192.168</span>.<span class="number">1.198</span><span class="symbol">:/root/</span>.ssh/authorized_keys</div></pre></td></tr></table></figure>]]></content>
      
        <categories>
            
            <category> linux </category>
            
        </categories>
        
        
        <tags>
            
            <tag> linux </tag>
            
            <tag> scp </tag>
            
        </tags>
        
    </entry>
    
    <entry>
      <title><![CDATA[谈谈对测试驱动开发思想的体会]]></title>
      <url>/2017/09/14/%E8%B0%88%E8%B0%88%E5%AF%B9%E6%B5%8B%E8%AF%95%E9%A9%B1%E5%8A%A8%E5%BC%80%E5%8F%91%E6%80%9D%E6%83%B3%E7%9A%84%E4%BD%93%E4%BC%9A/</url>
      <content type="html"><![CDATA[<p>最近学习了一本书《Python Web开发：测试驱动方法》，贯穿全书的便是测试驱动开发的编程思想。有点儿兵马未动，粮草先行的兵家思想。先简单总结一下这本书带给我的收获：1.学习了测试驱动开发的一种编程思想，与传统的瀑布开发流程又很大的出入。2.学习了如何写好功能测试，如何写好单元测试。3.先通过测试，再谈重构。</p>
<p>好，下面简单聊聊我对这种编程思想的体会。</p>
<h3 id="何为测试驱动开发"><a href="#何为测试驱动开发" class="headerlink" title="何为测试驱动开发"></a>何为测试驱动开发</h3><p><strong>维基百科</strong>中队测试驱动开发又一个比较正式的介绍：测试驱动开发（英语：Test-driven development，缩写为TDD）是一种软件开发过程中的应用方法，由极限编程中倡导，以其倡导先写测试程序，然后编码实现其功能得名。测试驱动开发始于20世纪90年代。测试驱动开发的目的是取得快速反馈并使用“illustrate the main line”方法来构建程序。</p>
<p>测试驱动开发是戴两顶帽子思考的开发方式：先戴上实现功能的帽子，在测试的辅助下，快速实现其功能；再戴上重构的帽子，在测试的保护下，通过去除冗余的代码，提高代码质量。测试驱动着整个开发过程：首先，驱动代码的设计和功能的实现；其后，驱动代码的再设计和重构。</p>
<p>按照我个人的理解：将业务需求转化为功能测试及单元测试，业务代码则为了通过测试而不断的迭代。</p>
<h3 id="测试驱动开发利弊权衡（由于未实战过tdd，看法可能略显稚嫩）"><a href="#测试驱动开发利弊权衡（由于未实战过tdd，看法可能略显稚嫩）" class="headerlink" title="测试驱动开发利弊权衡（由于未实战过tdd，看法可能略显稚嫩）"></a>测试驱动开发利弊权衡（由于未实战过tdd，看法可能略显稚嫩）</h3><ul>
<li>通过测试驱动开发，能保证业务代码能满足需求，不断的重构，能保证系统功能的正常运行。但是对于代码质量的把控，貌似很难做到。</li>
<li>测试驱动开发思想其实并不难理解，流程无非也是在测试开发重构过程中不断流转，但是个人感觉在工程实践上其实难度挺大</li>
<li>就个人工作经验来看，目前多数企业对于项目代码质量把控很差，项目周期紧，领导总是抱着先上线，遇到bug再解决，故TDD的开发模式在很多公司，尤其是创业公司中很难推广开，由于前期测试覆盖度不够，开发急促，导致后期上线维护异常困难</li>
<li>TDD的开发模式也应该分业务场景而看，但具体是哪些场景合适目前没有资格谈</li>
</ul>
<p>TDD这种方式，还是得实践。然而以目前公司的平台，基本属于不可能。不过，就算不能在公司实践TDD的开发模式，它其中最重要的核心部分–测试，会让我在今后的开发过程中更加重视这部分。</p>
]]></content>
      
        <categories>
            
            <category> 编程思想 </category>
            
        </categories>
        
        
        <tags>
            
            <tag> python </tag>
            
        </tags>
        
    </entry>
    
    <entry>
      <title><![CDATA[MySQL二进制日志格式类型详解]]></title>
      <url>/2017/07/13/MySQL%E4%BA%8C%E8%BF%9B%E5%88%B6%E6%97%A5%E5%BF%97%E6%A0%BC%E5%BC%8F%E7%B1%BB%E5%9E%8B%E8%AF%A6%E8%A7%A3/</url>
      <content type="html"><![CDATA[<p>mysql很多有类型的日志，按照组件划分的话，可以分为<strong> 服务层日志 </strong>和 <strong> 存储引擎层日志 </strong>：</p>
<ul>
<li>服务层日志：二进制日志、慢查日志、通用日志</li>
<li>存储引擎层日志：innodb(重做日志、回滚日志)</li>
</ul>
<p>其中比较重要的就是服务器层的二进制日志，其中记录了所有对mysql数据库的修改事件，包括增删改查事件和对表结构的修改事件。要注意的一点是，只有成功执行了的事件才会记录在二进制日志中，未执行成功的不会保存在二进制日志中。</p>
<h2 id="二进制日志的格式："><a href="#二进制日志的格式：" class="headerlink" title="二进制日志的格式："></a>二进制日志的格式：</h2><ul>
<li>基于段的格式 binlog_format=STATEMENT<ul>
<li>这是mysql5.7之前默认的二进制日志格式</li>
<li>记录的是mysql执行的sql语句</li>
<li>优点：<ul>
<li>日志记录量相对较小，节约磁盘及网络I/O</li>
</ul>
</li>
<li>缺点：<ul>
<li>必须要记录上下文信息，保证在从服务器上执行结果和住服务器上相同</li>
<li>对一些非确定性函数无法进行正确复制，比如UUID(), user()等</li>
<li>可能造成mysql复制的主备服务器数据不一致</li>
</ul>
</li>
</ul>
</li>
</ul>
<p>命令演示：</p>
<p>查看当前二进制日志记录格式<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">mysql&gt; show variables like &apos;binlog_format&apos;;</div><div class="line">+---------------+-------+</div><div class="line">| Variable_name | Value |</div><div class="line">+---------------+-------+</div><div class="line">| binlog_format | ROW   |</div><div class="line">+---------------+-------+</div><div class="line">1 row in set (0.01 sec)</div></pre></td></tr></table></figure></p>
<p>修改记录格式为statement，即改为基于段的格式<br><figure class="highlight gams"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">mysql&gt; <span class="keyword">set</span> session <span class="comment">binlog_format=statement</span>;</div><div class="line">Query OK, <span class="number">0</span> rows affected (<span class="number">0.00</span> sec)</div></pre></td></tr></table></figure></p>
<p>此时可用查看格式命令来确认一下，是否修改成功<br><figure class="highlight asciidoc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="section">mysql&gt; show variables like 'binlog_format';</span></div><div class="line">+---------------+-----------+</div><div class="line"><span class="section">| Variable_name | Value     |</span></div><div class="line">+---------------+-----------+</div><div class="line"><span class="section">| binlog_format | STATEMENT |</span></div><div class="line">+---------------+-----------+</div><div class="line">1 row in set (0.01 sec)</div></pre></td></tr></table></figure></p>
<p>查看当前二进制日志信息<br><figure class="highlight gherkin"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div></pre></td><td class="code"><pre><div class="line">mysql&gt; show binary logs;</div><div class="line">+------------------+-----------+</div><div class="line">|<span class="string"> Log_name         </span>|<span class="string"> File_size </span>|</div><div class="line">+------------------+-----------+</div><div class="line">|<span class="string"> mysql-bin.000058 </span>|<span class="string">       201 </span>|</div><div class="line">|<span class="string"> mysql-bin.000059 </span>|<span class="string">     12721 </span>|</div><div class="line">|<span class="string"> mysql-bin.000060 </span>|<span class="string">       201 </span>|</div><div class="line">|<span class="string"> mysql-bin.000061 </span>|<span class="string">       201 </span>|</div><div class="line">|<span class="string"> mysql-bin.000062 </span>|<span class="string">      1069 </span>|</div><div class="line">|<span class="string"> mysql-bin.000063 </span>|<span class="string">       201 </span>|</div><div class="line">|<span class="string"> mysql-bin.000064 </span>|<span class="string">       201 </span>|</div><div class="line">|<span class="string"> mysql-bin.000065 </span>|<span class="string">       177 </span>|</div><div class="line">|<span class="string"> mysql-bin.000066 </span>|<span class="string">       201 </span>|</div><div class="line">|<span class="string"> mysql-bin.000067 </span>|<span class="string">       177 </span>|</div><div class="line">|<span class="string"> mysql-bin.000068 </span>|<span class="string">       201 </span>|</div><div class="line">|<span class="string"> mysql-bin.000069 </span>|<span class="string">       177 </span>|</div><div class="line">|<span class="string"> mysql-bin.000070 </span>|<span class="string">       177 </span>|</div><div class="line">|<span class="string"> mysql-bin.000071 </span>|<span class="string">       201 </span>|</div><div class="line">|<span class="string"> mysql-bin.000072 </span>|<span class="string">       201 </span>|</div><div class="line">|<span class="string"> mysql-bin.000073 </span>|<span class="string">       154 </span>|</div><div class="line">+------------------+-----------+</div><div class="line">16 rows in set (0.00 sec)</div></pre></td></tr></table></figure></p>
<p>刷新日志，通过这个操作会产生一个新的log文件<br><figure class="highlight gherkin"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div></pre></td><td class="code"><pre><div class="line">mysql&gt; flush logs;</div><div class="line">Query OK, 0 rows affected (0.02 sec)</div><div class="line"></div><div class="line">mysql&gt; show binary logs;</div><div class="line">+------------------+-----------+</div><div class="line">|<span class="string"> Log_name         </span>|<span class="string"> File_size </span>|</div><div class="line">+------------------+-----------+</div><div class="line">|<span class="string"> mysql-bin.000059 </span>|<span class="string">     12721 </span>|</div><div class="line">|<span class="string"> mysql-bin.000060 </span>|<span class="string">       201 </span>|</div><div class="line">|<span class="string"> mysql-bin.000061 </span>|<span class="string">       201 </span>|</div><div class="line">|<span class="string"> mysql-bin.000062 </span>|<span class="string">      1069 </span>|</div><div class="line">|<span class="string"> mysql-bin.000063 </span>|<span class="string">       201 </span>|</div><div class="line">|<span class="string"> mysql-bin.000064 </span>|<span class="string">       201 </span>|</div><div class="line">|<span class="string"> mysql-bin.000065 </span>|<span class="string">       177 </span>|</div><div class="line">|<span class="string"> mysql-bin.000066 </span>|<span class="string">       201 </span>|</div><div class="line">|<span class="string"> mysql-bin.000067 </span>|<span class="string">       177 </span>|</div><div class="line">|<span class="string"> mysql-bin.000068 </span>|<span class="string">       201 </span>|</div><div class="line">|<span class="string"> mysql-bin.000069 </span>|<span class="string">       177 </span>|</div><div class="line">|<span class="string"> mysql-bin.000070 </span>|<span class="string">       177 </span>|</div><div class="line">|<span class="string"> mysql-bin.000071 </span>|<span class="string">       201 </span>|</div><div class="line">|<span class="string"> mysql-bin.000072 </span>|<span class="string">       201 </span>|</div><div class="line">|<span class="string"> mysql-bin.000073 </span>|<span class="string">       201 </span>|</div><div class="line">|<span class="string"> mysql-bin.000074 </span>|<span class="string">       154 </span>|</div><div class="line">+------------------+-----------+</div><div class="line">16 rows in set (0.00 sec)</div></pre></td></tr></table></figure></p>
<p>现在进行一个测试操作，创建一个新的数据库及表，并插入更新一些数据。<br><figure class="highlight shell"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line"><span class="meta">mysql&gt;</span><span class="bash"> create database <span class="built_in">test</span>;</span></div><div class="line">Query OK, 1 row affected (0.00 sec)</div><div class="line"><span class="meta"></span></div><div class="line">mysql&gt;<span class="bash"> use <span class="built_in">test</span>;</span></div><div class="line">Database changed</div><div class="line"><span class="meta">mysql&gt;</span><span class="bash"> create table t(id int, c1 varchar(10));</span></div><div class="line">Query OK, 0 rows affected (0.02 sec)</div><div class="line"><span class="meta"></span></div><div class="line">mysql&gt;<span class="bash"> insert into t values(1, <span class="string">'aa'</span>),(2, <span class="string">'bb'</span>);</span></div><div class="line">Query OK, 2 rows affected (0.02 sec)</div><div class="line">Records: 2  Duplicates: 0  Warnings: 0</div><div class="line"><span class="meta"></span></div><div class="line">mysql&gt;<span class="bash"> update t <span class="built_in">set</span> c1=<span class="string">'dd'</span> <span class="built_in">where</span> id=1;</span></div><div class="line">Query OK, 1 row affected (0.00 sec)</div><div class="line">Rows matched: 1  Changed: 1  Warnings: 0</div></pre></td></tr></table></figure></p>
<p>这个时候可以进入存放日志的文件夹进行查看二进制日志的具体内容，<br>不同的操作系统存放路径不同。以ubuntu为例，路径为/var/log/mysql</p>
<p>刚才的操作已经写入新生成的binlog文件中，使用mysqlbinlog命令打开最新的log文件，在此文件中可以清晰的查看到我们所操作过的sql语句<br><figure class="highlight mipsasm"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># lee @ acer in /var/log/mysql [10:58:38] C:127</span></div><div class="line">$ mysqlbinlog mysql-<span class="keyword">bin.000074</span></div><div class="line"><span class="comment">/*!50530 SET @@SESSION.PSEUDO_SLAVE_MODE=1*/</span><span class="comment">;</span></div><div class="line"><span class="comment">/*!50003 SET @OLD_COMPLETION_TYPE=@@COMPLETION_TYPE,COMPLETION_TYPE=0*/</span><span class="comment">;</span></div><div class="line">DELIMITER <span class="comment">/*!*/</span><span class="comment">;</span></div><div class="line"><span class="comment"># at 4</span></div><div class="line"><span class="comment">#170713 10:40:30 server id 1  end_log_pos 123 CRC32 0x3bcc260d 	Start: binlog v 4, server v 5.7.18-0ubuntu0.16.04.1-log created 170713 10:40:30</span></div><div class="line"><span class="comment"># Warning: this binlog is either in use or was not closed properly.</span></div><div class="line"><span class="keyword">BINLOG </span><span class="string">'</span></div><div class="line">nt1mWQ8BAAAAdwAAAHsAAAABAAQANS43LjE4LTB1YnVudHUwLjE2LjA0LjEtbG9nAAAAAAAAAAAA</div><div class="line">AAAAAAAAAAAAAAAAAAAAAAAAEzgNAAgAEgAEBAQEEgAAXwAEGggAAAAICAgCAAAACgoKKioAEjQA</div><div class="line">AQ0mzDs=</div><div class="line">'<span class="comment">/*!*/</span><span class="comment">;</span></div><div class="line"><span class="comment"># at 123</span></div><div class="line"><span class="comment">#170713 10:40:30 server id 1  end_log_pos 154 CRC32 0x004e07fa 	Previous-GTIDs</span></div><div class="line"><span class="comment"># [empty]</span></div><div class="line"><span class="comment"># at 154</span></div><div class="line"><span class="comment">#170713 10:42:47 server id 1  end_log_pos 219 CRC32 0x6d2f1e61 	Anonymous_GTID	last_committed=0	sequence_number=1</span></div><div class="line">SET @@SESSION.GTID_NEXT= <span class="string">'ANONYMOUS'</span><span class="comment">/*!*/</span><span class="comment">;</span></div><div class="line"><span class="comment"># at 219</span></div><div class="line"><span class="comment">#170713 10:42:47 server id 1  end_log_pos 313 CRC32 0x182062d1 	Query	thread_id=8	exec_time=0	error_code=0</span></div><div class="line">SET TIMESTAMP=<span class="number">1499913767</span><span class="comment">/*!*/</span><span class="comment">;</span></div><div class="line">SET @@session.pseudo_thread_id=<span class="number">8</span><span class="comment">/*!*/</span><span class="comment">;</span></div><div class="line">SET @@session.foreign_key_checks=<span class="number">1</span>, @@session.sql_auto_is_null=<span class="number">0</span>, @@session.unique_checks=<span class="number">1</span>, @@session.autocommit=<span class="number">1</span><span class="comment">/*!*/</span><span class="comment">;</span></div><div class="line">SET @@session.sql_mode=<span class="number">1436549152</span><span class="comment">/*!*/</span><span class="comment">;</span></div><div class="line">SET @@session.auto_increment_increment=<span class="number">1</span>, @@session.auto_increment_offset=<span class="number">1</span><span class="comment">/*!*/</span><span class="comment">;</span></div><div class="line"><span class="comment">/*!\C utf8 */</span><span class="comment">/*!*/</span><span class="comment">;</span></div><div class="line">SET @@session.character_set_client=<span class="number">33</span>,@@session.collation_connection=<span class="number">33</span>,@@session.collation_server=<span class="number">33</span><span class="comment">/*!*/</span><span class="comment">;</span></div><div class="line">SET @@session.lc_time_names=<span class="number">0</span><span class="comment">/*!*/</span><span class="comment">;</span></div><div class="line">SET @@session.collation_database=DEFAULT<span class="comment">/*!*/</span><span class="comment">;</span></div><div class="line">create database test</div><div class="line"><span class="comment">/*!*/</span><span class="comment">;</span></div><div class="line"><span class="comment"># at 313</span></div><div class="line"><span class="comment">#170713 10:43:14 server id 1  end_log_pos 378 CRC32 0x5af42684 	Anonymous_GTID	last_committed=1	sequence_number=2</span></div><div class="line">SET @@SESSION.GTID_NEXT= <span class="string">'ANONYMOUS'</span><span class="comment">/*!*/</span><span class="comment">;</span></div><div class="line"><span class="comment"># at 378</span></div><div class="line"><span class="comment">#170713 10:43:14 server id 1  end_log_pos 490 CRC32 0x926e1454 	Query	thread_id=8	exec_time=0	error_code=0</span></div><div class="line">use `test`<span class="comment">/*!*/</span><span class="comment">;</span></div><div class="line">SET TIMESTAMP=<span class="number">1499913794</span><span class="comment">/*!*/</span><span class="comment">;</span></div><div class="line">create table t(id int, c1 varchar(<span class="number">10</span>))</div><div class="line"><span class="comment">/*!*/</span><span class="comment">;</span></div><div class="line"><span class="comment"># at 490</span></div><div class="line"><span class="comment">#170713 10:43:37 server id 1  end_log_pos 555 CRC32 0x571dd95f 	Anonymous_GTID	last_committed=2	sequence_number=3</span></div><div class="line">SET @@SESSION.GTID_NEXT= <span class="string">'ANONYMOUS'</span><span class="comment">/*!*/</span><span class="comment">;</span></div><div class="line"><span class="comment"># at 555</span></div><div class="line"><span class="comment">#170713 10:43:37 server id 1  end_log_pos 634 CRC32 0xea457c9c 	Query	thread_id=8	exec_time=0	error_code=0</span></div><div class="line">SET TIMESTAMP=<span class="number">1499913817</span><span class="comment">/*!*/</span><span class="comment">;</span></div><div class="line"><span class="keyword">BEGIN</span></div><div class="line"><span class="comment">/*!*/</span><span class="comment">;</span></div><div class="line"><span class="comment"># at 634</span></div><div class="line"><span class="comment">#170713 10:43:37 server id 1  end_log_pos 747 CRC32 0x84b084e8 	Query	thread_id=8	exec_time=0	error_code=0</span></div><div class="line">SET TIMESTAMP=<span class="number">1499913817</span><span class="comment">/*!*/</span><span class="comment">;</span></div><div class="line"><span class="keyword">insert </span>into t values(<span class="number">1</span>, <span class="string">'aa'</span>),(<span class="number">2</span>, <span class="string">'bb'</span>)</div><div class="line"><span class="comment">/*!*/</span><span class="comment">;</span></div><div class="line"><span class="comment"># at 747</span></div><div class="line"><span class="comment">#170713 10:43:37 server id 1  end_log_pos 778 CRC32 0xb4d17852 	Xid = 25</span></div><div class="line">COMMIT<span class="comment">/*!*/</span><span class="comment">;</span></div><div class="line"><span class="comment"># at 778</span></div><div class="line"><span class="comment">#170713 10:45:32 server id 1  end_log_pos 843 CRC32 0x45fa3a6e 	Anonymous_GTID	last_committed=3	sequence_number=4</span></div><div class="line">SET @@SESSION.GTID_NEXT= <span class="string">'ANONYMOUS'</span><span class="comment">/*!*/</span><span class="comment">;</span></div><div class="line"><span class="comment"># at 843</span></div><div class="line"><span class="comment">#170713 10:45:32 server id 1  end_log_pos 922 CRC32 0x8fbf2543 	Query	thread_id=8	exec_time=0	error_code=0</span></div><div class="line">SET TIMESTAMP=<span class="number">1499913932</span><span class="comment">/*!*/</span><span class="comment">;</span></div><div class="line"><span class="keyword">BEGIN</span></div><div class="line"><span class="comment">/*!*/</span><span class="comment">;</span></div><div class="line"><span class="comment"># at 922</span></div><div class="line"><span class="comment">#170713 10:45:32 server id 1  end_log_pos 1027 CRC32 0xd4bcab33 	Query	thread_id=8	exec_time=0	error_code=0</span></div><div class="line">SET TIMESTAMP=<span class="number">1499913932</span><span class="comment">/*!*/</span><span class="comment">;</span></div><div class="line">update t set c1=<span class="string">'dd'</span> where id=<span class="number">1</span></div><div class="line"><span class="comment">/*!*/</span><span class="comment">;</span></div><div class="line"><span class="comment"># at 1027</span></div><div class="line"><span class="comment">#170713 10:45:32 server id 1  end_log_pos 1058 CRC32 0x769f943d 	Xid = 26</span></div><div class="line">COMMIT<span class="comment">/*!*/</span><span class="comment">;</span></div><div class="line">SET @@SESSION.GTID_NEXT= <span class="string">'AUTOMATIC'</span> <span class="comment">/* added by mysqlbinlog */</span> <span class="comment">/*!*/</span><span class="comment">;</span></div><div class="line">DELIMITER <span class="comment">;</span></div><div class="line"><span class="comment"># End of log file</span></div><div class="line"><span class="comment">/*!50003 SET COMPLETION_TYPE=@OLD_COMPLETION_TYPE*/</span><span class="comment">;</span></div><div class="line"><span class="comment">/*!50530 SET @@SESSION.PSEUDO_SLAVE_MODE=0*/</span><span class="comment">;</span></div></pre></td></tr></table></figure></p>
<hr>
<ul>
<li>基于行的日志格式 binlog_format=ROW<ul>
<li>这是mysql5.7之后默认的二进制日志格式</li>
<li>记录的是增删改查的数据行信息</li>
<li>优点：<ul>
<li>使mysql主从复制更加安全</li>
<li>对每一行数据的修改比基于段的复制高效</li>
<li>由于误操作修改数据库信息，且没有备库可恢复时，可通过对日志文件数据操作反向处理恢复数据</li>
</ul>
</li>
<li>缺点：<ul>
<li>记录日志量较大<ul>
<li>binlog_row_image =[FULL|MINIMAL|NOBLOB]</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
<p>命令演示：</p>
<p>切换日志格式并刷新日志<br><figure class="highlight asciidoc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line">mysql&gt; set session binlog<span class="emphasis">_format=row;</span></div><div class="line">Query OK, 0 rows affected (0.00 sec)</div><div class="line"></div><div class="line"><span class="section">mysql&gt; show variables like 'binlog_format';</span></div><div class="line">+---------------+-------+</div><div class="line"><span class="section">| Variable_name | Value |</span></div><div class="line">+---------------+-------+</div><div class="line"><span class="section">| binlog_format | ROW   |</span></div><div class="line">+---------------+-------+</div><div class="line">1 row in set (0.00 sec)</div><div class="line"></div><div class="line">mysql&gt; flush logs;</div><div class="line">Query OK, 0 rows affected (0.02 sec)</div></pre></td></tr></table></figure></p>
<p>查看binlog_row_image参数默认值<br><figure class="highlight asciidoc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="section">mysql&gt; show variables like 'binlog_row_image';</span></div><div class="line">+------------------+-------+</div><div class="line"><span class="section">| Variable_name    | Value |</span></div><div class="line">+------------------+-------+</div><div class="line"><span class="section">| binlog_row_image | FULL  |</span></div><div class="line">+------------------+-------+</div><div class="line">1 row in set (0.00 sec)</div></pre></td></tr></table></figure></p>
<p>为方便演示noblob参数效果，修改数据库表信息，增加一列text字段<br><figure class="highlight asciidoc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line">mysql&gt; alter table t add c2 text;</div><div class="line">Query OK, 0 rows affected (0.06 sec)</div><div class="line">Records: 0  Duplicates: 0  Warnings: 0</div><div class="line"></div><div class="line"><span class="section">mysql&gt; select * from t;</span></div><div class="line">+------+------+------+</div><div class="line"><span class="section">| id   | c1   | c2   |</span></div><div class="line">+------+------+------+</div><div class="line">|    1 | dd   | NULL |</div><div class="line"><span class="section">|    2 | bb   | NULL |</span></div><div class="line">+------+------+------+</div><div class="line">2 rows in set (0.01 sec)</div></pre></td></tr></table></figure></p>
<p>随意执行一些sql操作<br><figure class="highlight n1ql"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">mysql&gt; <span class="keyword">insert</span> <span class="keyword">into</span> t <span class="keyword">values</span>(<span class="number">3</span>, <span class="string">'haha'</span>, <span class="string">'llala'</span>);</div><div class="line">Query OK, 1 row affected (0.01 sec)</div><div class="line"></div><div class="line">mysql&gt; <span class="keyword">delete</span> <span class="keyword">from</span> t <span class="keyword">where</span> id=<span class="number">1</span>;</div><div class="line">Query OK, 1 row affected (0.00 sec)</div></pre></td></tr></table></figure></p>
<p>查看binlog日志<br><figure class="highlight mipsasm"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># lee @ acer in /var/log/mysql [14:45:28] </span></div><div class="line">$ mysqlbinlog mysql-<span class="keyword">bin.000076</span></div><div class="line"><span class="comment">/*!50530 SET @@SESSION.PSEUDO_SLAVE_MODE=1*/</span><span class="comment">;</span></div><div class="line"><span class="comment">/*!50003 SET @OLD_COMPLETION_TYPE=@@COMPLETION_TYPE,COMPLETION_TYPE=0*/</span><span class="comment">;</span></div><div class="line">DELIMITER <span class="comment">/*!*/</span><span class="comment">;</span></div><div class="line"><span class="comment"># at 4</span></div><div class="line"><span class="comment">#170713 14:35:53 server id 1  end_log_pos 123 CRC32 0xbf52e415 	Start: binlog v 4, server v 5.7.18-0ubuntu0.16.04.1-log created 170713 14:35:53</span></div><div class="line"><span class="comment"># Warning: this binlog is either in use or was not closed properly.</span></div><div class="line"><span class="keyword">BINLOG </span><span class="string">'</span></div><div class="line">yRRnWQ8BAAAAdwAAAHsAAAABAAQANS43LjE4LTB1YnVudHUwLjE2LjA0LjEtbG9nAAAAAAAAAAAA</div><div class="line">AAAAAAAAAAAAAAAAAAAAAAAAEzgNAAgAEgAEBAQEEgAAXwAEGggAAAAICAgCAAAACgoKKioAEjQA</div><div class="line">ARXkUr8=</div><div class="line">'<span class="comment">/*!*/</span><span class="comment">;</span></div><div class="line"><span class="comment"># at 123</span></div><div class="line"><span class="comment">#170713 14:35:53 server id 1  end_log_pos 154 CRC32 0xafecf53d 	Previous-GTIDs</span></div><div class="line"><span class="comment"># [empty]</span></div><div class="line"><span class="comment"># at 154</span></div><div class="line"><span class="comment">#170713 14:43:03 server id 1  end_log_pos 219 CRC32 0x491b5a7e 	Anonymous_GTID	last_committed=0	sequence_number=1</span></div><div class="line">SET @@SESSION.GTID_NEXT= <span class="string">'ANONYMOUS'</span><span class="comment">/*!*/</span><span class="comment">;</span></div><div class="line"><span class="comment"># at 219</span></div><div class="line"><span class="comment">#170713 14:43:03 server id 1  end_log_pos 318 CRC32 0x4acf1cd1 	Query	thread_id=8	exec_time=0	error_code=0</span></div><div class="line">use `test`<span class="comment">/*!*/</span><span class="comment">;</span></div><div class="line">SET TIMESTAMP=<span class="number">1499928183</span><span class="comment">/*!*/</span><span class="comment">;</span></div><div class="line">SET @@session.pseudo_thread_id=<span class="number">8</span><span class="comment">/*!*/</span><span class="comment">;</span></div><div class="line">SET @@session.foreign_key_checks=<span class="number">1</span>, @@session.sql_auto_is_null=<span class="number">0</span>, @@session.unique_checks=<span class="number">1</span>, @@session.autocommit=<span class="number">1</span><span class="comment">/*!*/</span><span class="comment">;</span></div><div class="line">SET @@session.sql_mode=<span class="number">1436549152</span><span class="comment">/*!*/</span><span class="comment">;</span></div><div class="line">SET @@session.auto_increment_increment=<span class="number">1</span>, @@session.auto_increment_offset=<span class="number">1</span><span class="comment">/*!*/</span><span class="comment">;</span></div><div class="line"><span class="comment">/*!\C utf8 */</span><span class="comment">/*!*/</span><span class="comment">;</span></div><div class="line">SET @@session.character_set_client=<span class="number">33</span>,@@session.collation_connection=<span class="number">33</span>,@@session.collation_server=<span class="number">33</span><span class="comment">/*!*/</span><span class="comment">;</span></div><div class="line">SET @@session.lc_time_names=<span class="number">0</span><span class="comment">/*!*/</span><span class="comment">;</span></div><div class="line">SET @@session.collation_database=DEFAULT<span class="comment">/*!*/</span><span class="comment">;</span></div><div class="line">alter table t <span class="keyword">add </span>c2 text</div><div class="line"><span class="comment">/*!*/</span><span class="comment">;</span></div><div class="line"><span class="comment"># at 318</span></div><div class="line"><span class="comment">#170713 14:44:02 server id 1  end_log_pos 383 CRC32 0x8437eaf9 	Anonymous_GTID	last_committed=1	sequence_number=2</span></div><div class="line">SET @@SESSION.GTID_NEXT= <span class="string">'ANONYMOUS'</span><span class="comment">/*!*/</span><span class="comment">;</span></div><div class="line"><span class="comment"># at 383</span></div><div class="line"><span class="comment">#170713 14:44:02 server id 1  end_log_pos 455 CRC32 0x57adaf15 	Query	thread_id=8	exec_time=0	error_code=0</span></div><div class="line">SET TIMESTAMP=<span class="number">1499928242</span><span class="comment">/*!*/</span><span class="comment">;</span></div><div class="line"><span class="keyword">BEGIN</span></div><div class="line"><span class="comment">/*!*/</span><span class="comment">;</span></div><div class="line"><span class="comment"># at 455</span></div><div class="line"><span class="comment">#170713 14:44:02 server id 1  end_log_pos 504 CRC32 0xdba65133 	Table_map: `test`.`t` mapped to number 498</span></div><div class="line"><span class="comment"># at 504</span></div><div class="line"><span class="comment">#170713 14:44:02 server id 1  end_log_pos 556 CRC32 0x19769a28 	Write_rows: table id 498 flags: STMT_END_F</span></div><div class="line"></div><div class="line"><span class="keyword">BINLOG </span><span class="string">'</span></div><div class="line">shZnWRMBAAAAMQAAAPgBAAAAAPIBAAAAAAEABHRlc3QAAXQAAwMP/AMeAAIHM1Gm2w==</div><div class="line">shZnWR4BAAAANAAAACwCAAAAAPIBAAAAAAEAAgAD//gDAAAABGhhaGEFAGxsYWxhKJp2GQ==</div><div class="line">'<span class="comment">/*!*/</span><span class="comment">;</span></div><div class="line"><span class="comment"># at 556</span></div><div class="line"><span class="comment">#170713 14:44:02 server id 1  end_log_pos 587 CRC32 0x6184a9a1 	Xid = 47</span></div><div class="line">COMMIT<span class="comment">/*!*/</span><span class="comment">;</span></div><div class="line"><span class="comment"># at 587</span></div><div class="line"><span class="comment">#170713 14:44:16 server id 1  end_log_pos 652 CRC32 0xc585d273 	Anonymous_GTID	last_committed=2	sequence_number=3</span></div><div class="line">SET @@SESSION.GTID_NEXT= <span class="string">'ANONYMOUS'</span><span class="comment">/*!*/</span><span class="comment">;</span></div><div class="line"><span class="comment"># at 652</span></div><div class="line"><span class="comment">#170713 14:44:16 server id 1  end_log_pos 724 CRC32 0x63005380 	Query	thread_id=8	exec_time=0	error_code=0</span></div><div class="line">SET TIMESTAMP=<span class="number">1499928256</span><span class="comment">/*!*/</span><span class="comment">;</span></div><div class="line"><span class="keyword">BEGIN</span></div><div class="line"><span class="comment">/*!*/</span><span class="comment">;</span></div><div class="line"><span class="comment"># at 724</span></div><div class="line"><span class="comment">#170713 14:44:16 server id 1  end_log_pos 773 CRC32 0x2c52eaa1 	Table_map: `test`.`t` mapped to number 498</span></div><div class="line"><span class="comment"># at 773</span></div><div class="line"><span class="comment">#170713 14:44:16 server id 1  end_log_pos 816 CRC32 0xa80bd454 	Delete_rows: table id 498 flags: STMT_END_F</span></div><div class="line"></div><div class="line"><span class="keyword">BINLOG </span><span class="string">'</span></div><div class="line">wBZnWRMBAAAAMQAAAAUDAAAAAPIBAAAAAAEABHRlc3QAAXQAAwMP/AMeAAIHoepSLA==</div><div class="line">wBZnWSABAAAAKwAAADADAAAAAPIBAAAAAAEAAgAD//wBAAAAAmRkVNQLqA==</div><div class="line">'<span class="comment">/*!*/</span><span class="comment">;</span></div><div class="line"><span class="comment"># at 816</span></div><div class="line"><span class="comment">#170713 14:44:16 server id 1  end_log_pos 847 CRC32 0x9d03bcd0 	Xid = 48</span></div><div class="line">COMMIT<span class="comment">/*!*/</span><span class="comment">;</span></div><div class="line">SET @@SESSION.GTID_NEXT= <span class="string">'AUTOMATIC'</span> <span class="comment">/* added by mysqlbinlog */</span> <span class="comment">/*!*/</span><span class="comment">;</span></div><div class="line">DELIMITER <span class="comment">;</span></div><div class="line"><span class="comment"># End of log file</span></div><div class="line"><span class="comment">/*!50003 SET COMPLETION_TYPE=@OLD_COMPLETION_TYPE*/</span><span class="comment">;</span></div><div class="line"><span class="comment">/*!50530 SET @@SESSION.PSEUDO_SLAVE_MODE=0*/</span><span class="comment">;</span></div></pre></td></tr></table></figure></p>
<p>单纯的使用mysqlbinlog命令，我们无法直观的看懂日志中保存的信息，所以加参数打开<br><figure class="highlight mipsasm"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># lee @ acer in /var/log/mysql [14:45:44] </span></div><div class="line">$ mysqlbinlog -vv mysql-<span class="keyword">bin.000076</span></div><div class="line"><span class="comment">/*!50530 SET @@SESSION.PSEUDO_SLAVE_MODE=1*/</span><span class="comment">;</span></div><div class="line"><span class="comment">/*!50003 SET @OLD_COMPLETION_TYPE=@@COMPLETION_TYPE,COMPLETION_TYPE=0*/</span><span class="comment">;</span></div><div class="line">DELIMITER <span class="comment">/*!*/</span><span class="comment">;</span></div><div class="line"><span class="comment"># at 4</span></div><div class="line"><span class="comment">#170713 14:35:53 server id 1  end_log_pos 123 CRC32 0xbf52e415 	Start: binlog v 4, server v 5.7.18-0ubuntu0.16.04.1-log created 170713 14:35:53</span></div><div class="line"><span class="comment"># Warning: this binlog is either in use or was not closed properly.</span></div><div class="line"><span class="keyword">BINLOG </span><span class="string">'</span></div><div class="line">yRRnWQ8BAAAAdwAAAHsAAAABAAQANS43LjE4LTB1YnVudHUwLjE2LjA0LjEtbG9nAAAAAAAAAAAA</div><div class="line">AAAAAAAAAAAAAAAAAAAAAAAAEzgNAAgAEgAEBAQEEgAAXwAEGggAAAAICAgCAAAACgoKKioAEjQA</div><div class="line">ARXkUr8=</div><div class="line">'<span class="comment">/*!*/</span><span class="comment">;</span></div><div class="line"><span class="comment"># at 123</span></div><div class="line"><span class="comment">#170713 14:35:53 server id 1  end_log_pos 154 CRC32 0xafecf53d 	Previous-GTIDs</span></div><div class="line"><span class="comment"># [empty]</span></div><div class="line"><span class="comment"># at 154</span></div><div class="line"><span class="comment">#170713 14:43:03 server id 1  end_log_pos 219 CRC32 0x491b5a7e 	Anonymous_GTID	last_committed=0	sequence_number=1</span></div><div class="line">SET @@SESSION.GTID_NEXT= <span class="string">'ANONYMOUS'</span><span class="comment">/*!*/</span><span class="comment">;</span></div><div class="line"><span class="comment"># at 219</span></div><div class="line"><span class="comment">#170713 14:43:03 server id 1  end_log_pos 318 CRC32 0x4acf1cd1 	Query	thread_id=8	exec_time=0	error_code=0</span></div><div class="line">use `test`<span class="comment">/*!*/</span><span class="comment">;</span></div><div class="line">SET TIMESTAMP=<span class="number">1499928183</span><span class="comment">/*!*/</span><span class="comment">;</span></div><div class="line">SET @@session.pseudo_thread_id=<span class="number">8</span><span class="comment">/*!*/</span><span class="comment">;</span></div><div class="line">SET @@session.foreign_key_checks=<span class="number">1</span>, @@session.sql_auto_is_null=<span class="number">0</span>, @@session.unique_checks=<span class="number">1</span>, @@session.autocommit=<span class="number">1</span><span class="comment">/*!*/</span><span class="comment">;</span></div><div class="line">SET @@session.sql_mode=<span class="number">1436549152</span><span class="comment">/*!*/</span><span class="comment">;</span></div><div class="line">SET @@session.auto_increment_increment=<span class="number">1</span>, @@session.auto_increment_offset=<span class="number">1</span><span class="comment">/*!*/</span><span class="comment">;</span></div><div class="line"><span class="comment">/*!\C utf8 */</span><span class="comment">/*!*/</span><span class="comment">;</span></div><div class="line">SET @@session.character_set_client=<span class="number">33</span>,@@session.collation_connection=<span class="number">33</span>,@@session.collation_server=<span class="number">33</span><span class="comment">/*!*/</span><span class="comment">;</span></div><div class="line">SET @@session.lc_time_names=<span class="number">0</span><span class="comment">/*!*/</span><span class="comment">;</span></div><div class="line">SET @@session.collation_database=DEFAULT<span class="comment">/*!*/</span><span class="comment">;</span></div><div class="line">alter table t <span class="keyword">add </span>c2 text</div><div class="line"><span class="comment">/*!*/</span><span class="comment">;</span></div><div class="line"><span class="comment"># at 318</span></div><div class="line"><span class="comment">#170713 14:44:02 server id 1  end_log_pos 383 CRC32 0x8437eaf9 	Anonymous_GTID	last_committed=1	sequence_number=2</span></div><div class="line">SET @@SESSION.GTID_NEXT= <span class="string">'ANONYMOUS'</span><span class="comment">/*!*/</span><span class="comment">;</span></div><div class="line"><span class="comment"># at 383</span></div><div class="line"><span class="comment">#170713 14:44:02 server id 1  end_log_pos 455 CRC32 0x57adaf15 	Query	thread_id=8	exec_time=0	error_code=0</span></div><div class="line">SET TIMESTAMP=<span class="number">1499928242</span><span class="comment">/*!*/</span><span class="comment">;</span></div><div class="line"><span class="keyword">BEGIN</span></div><div class="line"><span class="comment">/*!*/</span><span class="comment">;</span></div><div class="line"><span class="comment"># at 455</span></div><div class="line"><span class="comment">#170713 14:44:02 server id 1  end_log_pos 504 CRC32 0xdba65133 	Table_map: `test`.`t` mapped to number 498</span></div><div class="line"><span class="comment"># at 504</span></div><div class="line"><span class="comment">#170713 14:44:02 server id 1  end_log_pos 556 CRC32 0x19769a28 	Write_rows: table id 498 flags: STMT_END_F</span></div><div class="line"></div><div class="line"><span class="keyword">BINLOG </span><span class="string">'</span></div><div class="line">shZnWRMBAAAAMQAAAPgBAAAAAPIBAAAAAAEABHRlc3QAAXQAAwMP/AMeAAIHM1Gm2w==</div><div class="line">shZnWR4BAAAANAAAACwCAAAAAPIBAAAAAAEAAgAD//gDAAAABGhhaGEFAGxsYWxhKJp2GQ==</div><div class="line">'<span class="comment">/*!*/</span><span class="comment">;</span></div><div class="line"><span class="comment">### INSERT INTO `test`.`t`</span></div><div class="line"><span class="comment">### SET</span></div><div class="line"><span class="comment">###   @1=3 /* INT meta=0 nullable=1 is_null=0 */</span></div><div class="line"><span class="comment">###   @2='haha' /* VARSTRING(30) meta=30 nullable=1 is_null=0 */</span></div><div class="line"><span class="comment">###   @3='llala' /* BLOB/TEXT meta=2 nullable=1 is_null=0 */</span></div><div class="line"><span class="comment"># at 556</span></div><div class="line"><span class="comment">#170713 14:44:02 server id 1  end_log_pos 587 CRC32 0x6184a9a1 	Xid = 47</span></div><div class="line">COMMIT<span class="comment">/*!*/</span><span class="comment">;</span></div><div class="line"><span class="comment"># at 587</span></div><div class="line"><span class="comment">#170713 14:44:16 server id 1  end_log_pos 652 CRC32 0xc585d273 	Anonymous_GTID	last_committed=2	sequence_number=3</span></div><div class="line">SET @@SESSION.GTID_NEXT= <span class="string">'ANONYMOUS'</span><span class="comment">/*!*/</span><span class="comment">;</span></div><div class="line"><span class="comment"># at 652</span></div><div class="line"><span class="comment">#170713 14:44:16 server id 1  end_log_pos 724 CRC32 0x63005380 	Query	thread_id=8	exec_time=0	error_code=0</span></div><div class="line">SET TIMESTAMP=<span class="number">1499928256</span><span class="comment">/*!*/</span><span class="comment">;</span></div><div class="line"><span class="keyword">BEGIN</span></div><div class="line"><span class="comment">/*!*/</span><span class="comment">;</span></div><div class="line"><span class="comment"># at 724</span></div><div class="line"><span class="comment">#170713 14:44:16 server id 1  end_log_pos 773 CRC32 0x2c52eaa1 	Table_map: `test`.`t` mapped to number 498</span></div><div class="line"><span class="comment"># at 773</span></div><div class="line"><span class="comment">#170713 14:44:16 server id 1  end_log_pos 816 CRC32 0xa80bd454 	Delete_rows: table id 498 flags: STMT_END_F</span></div><div class="line"></div><div class="line"><span class="keyword">BINLOG </span><span class="string">'</span></div><div class="line">wBZnWRMBAAAAMQAAAAUDAAAAAPIBAAAAAAEABHRlc3QAAXQAAwMP/AMeAAIHoepSLA==</div><div class="line">wBZnWSABAAAAKwAAADADAAAAAPIBAAAAAAEAAgAD//wBAAAAAmRkVNQLqA==</div><div class="line">'<span class="comment">/*!*/</span><span class="comment">;</span></div><div class="line"><span class="comment">### DELETE FROM `test`.`t`</span></div><div class="line"><span class="comment">### WHERE</span></div><div class="line"><span class="comment">###   @1=1 /* INT meta=0 nullable=1 is_null=0 */</span></div><div class="line"><span class="comment">###   @2='dd' /* VARSTRING(30) meta=30 nullable=1 is_null=0 */</span></div><div class="line"><span class="comment">###   @3=NULL /* BLOB/TEXT meta=2 nullable=1 is_null=1 */</span></div><div class="line"><span class="comment"># at 816</span></div><div class="line"><span class="comment">#170713 14:44:16 server id 1  end_log_pos 847 CRC32 0x9d03bcd0 	Xid = 48</span></div><div class="line">COMMIT<span class="comment">/*!*/</span><span class="comment">;</span></div><div class="line">SET @@SESSION.GTID_NEXT= <span class="string">'AUTOMATIC'</span> <span class="comment">/* added by mysqlbinlog */</span> <span class="comment">/*!*/</span><span class="comment">;</span></div><div class="line">DELIMITER <span class="comment">;</span></div><div class="line"><span class="comment"># End of log file</span></div><div class="line"><span class="comment">/*!50003 SET COMPLETION_TYPE=@OLD_COMPLETION_TYPE*/</span><span class="comment">;</span></div><div class="line"><span class="comment">/*!50530 SET @@SESSION.PSEUDO_SLAVE_MODE=0*/</span><span class="comment">;</span></div></pre></td></tr></table></figure></p>
<p>这时，我们就可以找到我们所执行过的sql语句，同时这种格式的日志还记录了修改过的每一行数据的信息</p>
<p>修改binlog_row_image参数值，更新一条记录<br><figure class="highlight shell"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="meta">mysql&gt;</span><span class="bash"> <span class="built_in">set</span> session binlog_row_image=minimal;</span></div><div class="line">Query OK, 0 rows affected (0.00 sec)</div><div class="line"><span class="meta"></span></div><div class="line">mysql&gt;<span class="bash"> update t <span class="built_in">set</span> c2=<span class="string">'this 2'</span> <span class="built_in">where</span> id=2;</span></div><div class="line">Query OK, 1 row affected (0.00 sec)</div><div class="line">Rows matched: 1  Changed: 1  Warnings: 0</div></pre></td></tr></table></figure></p>
<p>查看binlog文件记录内容（只截取新增部分操作）<br><strong> 从记录内容可看出，日志只记录了修改那行数据的第三列，即c2的值，未变动的列并未记录</strong><br><figure class="highlight clean"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line">### UPDATE `test`.`t`</div><div class="line">### WHERE</div><div class="line">###   @<span class="number">1</span>=<span class="number">2</span> <span class="comment">/* INT meta=0 nullable=1 is_null=0 */</span></div><div class="line">###   @<span class="number">2</span>=<span class="string">'bb'</span> <span class="comment">/* VARSTRING(30) meta=30 nullable=1 is_null=0 */</span></div><div class="line">###   @<span class="number">3</span>=NULL <span class="comment">/* BLOB/TEXT meta=2 nullable=1 is_null=1 */</span></div><div class="line">### SET</div><div class="line">###   @<span class="number">3</span>=<span class="string">'this 2'</span> <span class="comment">/* BLOB/TEXT meta=2 nullable=1 is_null=0 */</span></div><div class="line"># at <span class="number">1086</span></div><div class="line">#<span class="number">170713</span> <span class="number">15</span>:<span class="number">18</span>:<span class="number">21</span> server id <span class="number">1</span>  end_log_pos <span class="number">1117</span> CRC32 <span class="number">0xfdd198ec</span> 	Xid = <span class="number">50</span></div><div class="line">COMMIT<span class="comment">/*!*/</span>;</div><div class="line">SET @@SESSION.GTID_NEXT= <span class="string">'AUTOMATIC'</span> <span class="comment">/* added by mysqlbinlog */</span> <span class="comment">/*!*/</span>;</div><div class="line">DELIMITER ;</div><div class="line"># End <span class="keyword">of</span> log file</div><div class="line"><span class="comment">/*!50003 SET COMPLETION_TYPE=@OLD_COMPLETION_TYPE*/</span>;</div><div class="line"><span class="comment">/*!50530 SET @@SESSION.PSEUDO_SLAVE_MODE=0*/</span>;</div></pre></td></tr></table></figure></p>
<p>继续修改binlog_row_image参数值，更新一条记录<br><figure class="highlight shell"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="meta">mysql&gt;</span><span class="bash"> <span class="built_in">set</span> session binlog_row_image=noblob;</span></div><div class="line">Query OK, 0 rows affected (0.00 sec)</div><div class="line"><span class="meta"></span></div><div class="line">mysql&gt;<span class="bash"> update t <span class="built_in">set</span> c1=<span class="string">'woqu'</span> <span class="built_in">where</span> id=3;</span></div><div class="line">Query OK, 1 row affected (0.01 sec)</div><div class="line">Rows matched: 1  Changed: 1  Warnings: 0</div></pre></td></tr></table></figure></p>
<p>查看binlog文件记录内容（同上）<br><strong> 从记录内容可以发现，日志只记录了第一列和第二列的数据，并没有记录第三列text属性的值 </strong><br><figure class="highlight clean"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">### UPDATE `test`.`t`</div><div class="line">### WHERE</div><div class="line">###   @<span class="number">1</span>=<span class="number">3</span> <span class="comment">/* INT meta=0 nullable=1 is_null=0 */</span></div><div class="line">###   @<span class="number">2</span>=<span class="string">'fff'</span> <span class="comment">/* VARSTRING(30) meta=30 nullable=1 is_null=0 */</span></div><div class="line">###   @<span class="number">3</span>=<span class="string">'llala'</span> <span class="comment">/* BLOB/TEXT meta=2 nullable=1 is_null=0 */</span></div><div class="line">### SET</div><div class="line">###   @<span class="number">1</span>=<span class="number">3</span> <span class="comment">/* INT meta=0 nullable=1 is_null=0 */</span></div><div class="line">###   @<span class="number">2</span>=<span class="string">'woqu'</span> <span class="comment">/* VARSTRING(30) meta=30 nullable=1 is_null=0 */</span></div><div class="line"># at <span class="number">1640</span></div><div class="line">#<span class="number">170713</span> <span class="number">15</span>:<span class="number">24</span>:<span class="number">28</span> server id <span class="number">1</span>  end_log_pos <span class="number">1671</span> CRC32 <span class="number">0x429c269c</span> 	Xid = <span class="number">55</span></div><div class="line">COMMIT<span class="comment">/*!*/</span>;</div></pre></td></tr></table></figure></p>
<p><strong> 总结一下binlog_row_format三种参数的记录差异 </strong></p>
<ul>
<li>FULL: 记录修改行的所有列数据</li>
<li>MINIMAL: 仅记录修改行中有发生数据变化的列</li>
<li>NOBOLB: 和FULL方式相似，仅仅是当blog或text这些列没有进行修改时，不会记录这些属性的列</li>
</ul>
<hr>
<ul>
<li>混合日志格式 binlog_format=MIXED<ul>
<li>特点：<ul>
<li>根据sql语句由系统决定在基于段和基于行的日志格式中进行选择</li>
<li>数据量的大小由所执行的sql语句决定</li>
</ul>
</li>
</ul>
</li>
</ul>
<hr>
<p><strong> 总结：在选择二进制日志格式时，通常选择基于行或者混合日志格式。然而对于数据复制安全性要求高的情况下，更建议使用基于行的日志格式。另外，如果选择这种格式，务必设置binlog_row_image=minimal</strong></p>
]]></content>
      
        <categories>
            
            <category> mysql </category>
            
        </categories>
        
        
        <tags>
            
            <tag> mysql </tag>
            
            <tag> 二进制日志，binlog </tag>
            
        </tags>
        
    </entry>
    
    <entry>
      <title><![CDATA[functools.lru_cache装饰器详解]]></title>
      <url>/2017/07/11/functools-lru-cache%E8%A3%85%E9%A5%B0%E5%99%A8%E8%AF%A6%E8%A7%A3/</url>
      <content type="html"><![CDATA[<p>在functools这个模块中，有lru_cache这个一个神奇的装饰器存在。functools.lru_cache的作用主要是用来做缓存，他能把相对耗时的函数结果进行保存，避免传入相同的参数重复计算。同时，缓存并不会无限增长，不用的缓存会被释放。</p>
<p>举fluent python中的例子来说：<br>首先实现一个计算运行时间的装饰器<br><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">import</span> time</div><div class="line"><span class="keyword">import</span> functools</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">clock</span><span class="params">(func)</span>:</span></div><div class="line"></div><div class="line">	<span class="comment"># functools.wraps(func)装饰器的作用是将func函数的相关属性复制到clock中</span></div><div class="line">    <span class="comment"># 比如说__name__, __doc__等等</span></div><div class="line"><span class="meta">    @functools.wraps(func)</span></div><div class="line">    <span class="function"><span class="keyword">def</span> <span class="title">clocked</span><span class="params">(*args, **kwargs)</span>:</span></div><div class="line">        t0 = time.time()</div><div class="line">        result = func(*args, **kwargs)</div><div class="line">        elapsed = time.time() - t0</div><div class="line">        name = func.__name__</div><div class="line">        arg_lst = []</div><div class="line">        <span class="keyword">if</span> args:</div><div class="line">        	arg_lst.append(<span class="string">', '</span>.join(repr(arg) <span class="keyword">for</span> arg <span class="keyword">in</span> args))</div><div class="line">        <span class="keyword">if</span> kwargs:</div><div class="line">        	pairs = [<span class="string">'%s=%r'</span> % (k, w) <span class="keyword">for</span> k, w <span class="keyword">in</span> sorted(kwargs.items())]</div><div class="line">        	arg_lst.append(<span class="string">', '</span>.join(pairs))</div><div class="line">        arg_str = <span class="string">', '</span>.join(arg_lst)</div><div class="line">        print(<span class="string">'[%0.8fs] %s(%s) -&gt; %r '</span> % (elapsed, name, arg_str, result))</div><div class="line">    <span class="keyword">return</span> result</div></pre></td></tr></table></figure></p>
<p>接下来写一个生成第n个斐波纳契数的函数<br><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">from</span> clockdeco <span class="keyword">import</span> clock</div><div class="line"></div><div class="line"><span class="meta">@clock</span></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">fibonacci</span><span class="params">(n)</span>:</span></div><div class="line">	<span class="keyword">if</span> n &lt; <span class="number">2</span>:</div><div class="line">		<span class="keyword">return</span> n</div><div class="line">	<span class="keyword">return</span> fibonacci(n<span class="number">-2</span>) + fibonacci(n<span class="number">-1</span>)</div><div class="line"></div><div class="line"><span class="keyword">if</span> __name__==<span class="string">'__main__'</span>:</div><div class="line">	print(fibonacci(<span class="number">6</span>))</div></pre></td></tr></table></figure></p>
<p>运行结果：<br><figure class="highlight lsl"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div></pre></td><td class="code"><pre><div class="line">[<span class="number">0.00000041</span>s] fibonacci(<span class="number">0</span>) -&gt; <span class="number">0</span></div><div class="line">[<span class="number">0.00000051</span>s] fibonacci(<span class="number">1</span>) -&gt; <span class="number">1</span></div><div class="line">[<span class="number">0.00003454</span>s] fibonacci(<span class="number">2</span>) -&gt; <span class="number">1</span></div><div class="line">[<span class="number">0.00000025</span>s] fibonacci(<span class="number">1</span>) -&gt; <span class="number">1</span></div><div class="line">[<span class="number">0.00000026</span>s] fibonacci(<span class="number">0</span>) -&gt; <span class="number">0</span></div><div class="line">[<span class="number">0.00000024</span>s] fibonacci(<span class="number">1</span>) -&gt; <span class="number">1</span></div><div class="line">[<span class="number">0.00000743</span>s] fibonacci(<span class="number">2</span>) -&gt; <span class="number">1</span></div><div class="line">[<span class="number">0.00001429</span>s] fibonacci(<span class="number">3</span>) -&gt; <span class="number">2</span></div><div class="line">[<span class="number">0.00005602</span>s] fibonacci(<span class="number">4</span>) -&gt; <span class="number">3</span></div><div class="line">[<span class="number">0.00000022</span>s] fibonacci(<span class="number">1</span>) -&gt; <span class="number">1</span></div><div class="line">[<span class="number">0.00000023</span>s] fibonacci(<span class="number">0</span>) -&gt; <span class="number">0</span></div><div class="line">[<span class="number">0.00000021</span>s] fibonacci(<span class="number">1</span>) -&gt; <span class="number">1</span></div><div class="line">[<span class="number">0.00000672</span>s] fibonacci(<span class="number">2</span>) -&gt; <span class="number">1</span></div><div class="line">[<span class="number">0.00001346</span>s] fibonacci(<span class="number">3</span>) -&gt; <span class="number">2</span></div><div class="line">[<span class="number">0.00000021</span>s] fibonacci(<span class="number">0</span>) -&gt; <span class="number">0</span></div><div class="line">[<span class="number">0.00000022</span>s] fibonacci(<span class="number">1</span>) -&gt; <span class="number">1</span></div><div class="line">[<span class="number">0.00000691</span>s] fibonacci(<span class="number">2</span>) -&gt; <span class="number">1</span></div><div class="line">[<span class="number">0.00000022</span>s] fibonacci(<span class="number">1</span>) -&gt; <span class="number">1</span></div><div class="line">[<span class="number">0.00000027</span>s] fibonacci(<span class="number">0</span>) -&gt; <span class="number">0</span></div><div class="line">[<span class="number">0.00000022</span>s] fibonacci(<span class="number">1</span>) -&gt; <span class="number">1</span></div><div class="line">[<span class="number">0.00000708</span>s] fibonacci(<span class="number">2</span>) -&gt; <span class="number">1</span></div><div class="line">[<span class="number">0.00001363</span>s] fibonacci(<span class="number">3</span>) -&gt; <span class="number">2</span></div><div class="line">[<span class="number">0.00002687</span>s] fibonacci(<span class="number">4</span>) -&gt; <span class="number">3</span></div><div class="line">[<span class="number">0.00004682</span>s] fibonacci(<span class="number">5</span>) -&gt; <span class="number">5</span></div><div class="line">[<span class="number">0.00011096</span>s] fibonacci(<span class="number">6</span>) -&gt; <span class="number">8</span></div><div class="line"><span class="number">8</span></div></pre></td></tr></table></figure></p>
<p>有大量的重复函数计算在整个运行过程中，比如fibonacci(1)，fibonacci(2)就分别运行了多次。<br>现在给fibonacci()函数加上@functools.lru_cache()装饰器进行缓存实现<br><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">from</span> clockdeco <span class="keyword">import</span> clock</div><div class="line"></div><div class="line"><span class="meta">@functools.lru_cache()</span></div><div class="line"><span class="meta">@clock</span></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">fibonacci</span><span class="params">(n)</span>:</span></div><div class="line">	<span class="keyword">if</span> n &lt; <span class="number">2</span>:</div><div class="line">		<span class="keyword">return</span> n</div><div class="line">	<span class="keyword">return</span> fibonacci(n<span class="number">-2</span>) + fibonacci(n<span class="number">-1</span>)</div><div class="line"></div><div class="line"><span class="keyword">if</span> __name__==<span class="string">'__main__'</span>:</div><div class="line">	print(fibonacci(<span class="number">6</span>))</div></pre></td></tr></table></figure></p>
<p>一共就多了一行代码，那看看运行结果如何。<br><figure class="highlight lsl"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">[<span class="number">0.00000041</span>s] fibonacci(<span class="number">0</span>) -&gt; <span class="number">0</span></div><div class="line">[<span class="number">0.00000054</span>s] fibonacci(<span class="number">1</span>) -&gt; <span class="number">1</span></div><div class="line">[<span class="number">0.00004040</span>s] fibonacci(<span class="number">2</span>) -&gt; <span class="number">1</span></div><div class="line">[<span class="number">0.00000104</span>s] fibonacci(<span class="number">3</span>) -&gt; <span class="number">2</span></div><div class="line">[<span class="number">0.00005465</span>s] fibonacci(<span class="number">4</span>) -&gt; <span class="number">3</span></div><div class="line">[<span class="number">0.00000072</span>s] fibonacci(<span class="number">5</span>) -&gt; <span class="number">5</span></div><div class="line">[<span class="number">0.00006876</span>s] fibonacci(<span class="number">6</span>) -&gt; <span class="number">8</span></div><div class="line"><span class="number">8</span></div></pre></td></tr></table></figure></p>
<p>不使用lru_cache装饰器时的运行时间是0.00011096s，加上以后变成了0.00006876s。这个效率增加的杠杆的，尤其在充斥这大量重复计算时，它更能够为程序的运行节省大量的时间。</p>
<p>另外：functools.lru_cache(maxsize=128, typed=False)有两个可选参数，我们来看看他们分别代表的意义。</p>
<p><strong> maxsize代表缓存的内存占用值，超过这个值之后，就的结果就会被释放，然后将新的计算结果进行缓存,其值应当设为2的幂 </strong></p>
<p><strong> typed若为True，则会把不同的参数类型得到的结果分开保存 </strong></p>
<p>ps：<br><figure class="highlight less"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="variable">@functools</span>.lru_cache()</div><div class="line"><span class="variable">@clock</span></div><div class="line">def fibonacci(n):</div><div class="line">	if n &lt; <span class="number">2</span>:</div><div class="line">		return n</div><div class="line">	return fibonacci(n-<span class="number">2</span>) + fibonacci(n-<span class="number">1</span>)</div></pre></td></tr></table></figure></p>
<p>这段代码中叠加使用了两个装饰器，那具体这两个装饰器的先后顺序是怎么样的。<br>举个例子：<br><figure class="highlight less"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="variable">@d1</span></div><div class="line"><span class="variable">@d2</span></div><div class="line">def f():</div><div class="line">	print(<span class="string">'f'</span>)</div></pre></td></tr></table></figure></p>
<p>等于<br><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">f</span><span class="params">()</span>:</span></div><div class="line">	print(<span class="string">'f'</span>)</div><div class="line"></div><div class="line">f = d1(d2(f))</div></pre></td></tr></table></figure></p>
<p>也就是说从下往上依次执行</p>
]]></content>
      
        <categories>
            
            <category> python </category>
            
        </categories>
        
        
        <tags>
            
            <tag> python </tag>
            
            <tag> 装饰器，functools </tag>
            
        </tags>
        
    </entry>
    
    <entry>
      <title><![CDATA[Scrapy架构简述]]></title>
      <url>/2017/07/05/Scrapy%E6%9E%B6%E6%9E%84%E7%AE%80%E8%BF%B0/</url>
      <content type="html"><![CDATA[<p>瞅一眼官方文档给出的架构图，此图中包含了Scrapy框架的基本组件构成以及数据流的走向。<br><img src="https://ooo.0o0.ooo/2017/07/04/595b0613922a8.png" alt="scrapy_architecture_02.png"></p>
<hr>
<p>第一眼看过去，有点蒙逼是正常的，接着往下看看就会会理解了。<br>先了解了解每个组件是做什么的：</p>
<p><strong> Spiders(爬虫类): Spiders是开发者自定义的一个类，用于解析相应并提取item或下个爬取的URL </strong></p>
<p><strong> Scrapy Engine(引擎): Engine负责控制数据流在系统中的流动走向，并在指定条件下触发一些事件。同时，也可以简单理解为Scrapy中数据流的中转站 </strong></p>
<p><strong> Scheduler(调度器): Scheduler接收Engine发出的requests，并将这些requests放入到处理队列中，以便之后Engine需要时再提供 </strong></p>
<p><strong> Downloader(下载器):  Downloader负责抓取网页信息并提供给Engine，进而转发至Spider </strong></p>
<p><strong> Item Pipeline(处理管道): Item Pipeline负责处理Spiders类处理提取之后的item，典型的处理有数据清洗，验证以及持久化 </strong></p>
<hr>
<p>下面需要在介绍一下架构中存在的两种中间件</p>
<p><strong> Spider middlewares: Spider中间件作为Spider和Engine中间存在的特定钩子，处理Engine返回的responses和自身向Engine输出的requests、items </strong></p>
<p><strong> Downloader middlewares: Downloader中间件作为Engine和Downloader中间存在的特定钩子，处理从Engine发出的requests和自身向Engine返回的responses </strong></p>
<p>在后期的讲解中，会慢慢涉及中间件的开发，并利用中间件方便的完成许多功能</p>
<hr>
<p>重点讲解一下整个架构的数据流的流通过程(看图理解)：</p>
<p><strong> 1. Engine从Spider获取到第一条Requests </strong></p>
<p><strong> 2. Engine将这条Requests发送至Scheduler,然后从Spider准备接收下一条Requests </strong></p>
<p><strong> 3. Schedulers取出队列中的一条Requests发送给Engine </strong></p>
<p><strong> 4. Engine 将接收到的Requests发送至Downloader，这个过程Requests会经过Downloader Middlewares </strong></p>
<p><strong> 5. 一旦页面完成下载，Downloader会成为一个Response，然后将它发送至Engine，这个发送过程也会经过Downloader Middlewares </strong></p>
<p><strong> 6. Engine接收到Response后，将它发送至Spider进行处理，会经过Spider Middlewares </strong></p>
<p><strong> 7. Spider处理完Response然后返回items和新的Requests至Engine，会经过Spider Middlewares </strong></p>
<p><strong> 8. Engine将接收到的Item发送至Item Pipelines，然后将Requests发送至Scheduler并准备接收下一条需要爬取的Requests </strong></p>
<p><strong> 9. 一次url的爬取过程结束了，然后会重复这个爬取过程，直到Schedueler中没有Requests需要处理。 </strong></p>
<hr>
<p>通过这篇文章的阅读，可以大概了解Scrapy框架基本构成及数据流的走向。对后续Scrapy的学习会有非常大的帮助，同时为进阶的Scrapy学习及源码的剖析打下基础。</p>
]]></content>
      
        <categories>
            
            <category> 爬虫 </category>
            
        </categories>
        
        
        <tags>
            
            <tag> 爬虫 </tag>
            
            <tag> 框架 </tag>
            
        </tags>
        
    </entry>
    
    <entry>
      <title><![CDATA[红绿灯下的思考]]></title>
      <url>/2017/06/10/%E7%BA%A2%E7%BB%BF%E7%81%AF%E4%B8%8B%E7%9A%84%E6%80%9D%E8%80%83/</url>
      <content type="html"><![CDATA[<p>今晚从健身房回家的时候，经过红绿灯时，正好红灯，停下了脚步。</p>
<p>突然意识到自己这日复一日的在人潮中涌动，在整条街中，在整个城市的灯光下，显得极为平凡，渺小。这一生，也许真的就只能是一个平凡的人，和千千万万的上班族一样为了生活奔波劳碌，来不及思考未来，来不及为真理的探索再迈近一步。</p>
<p>大学里所幻想未来的天马星空好像突然间没有了音讯，此时此刻想起那些曾经憧憬，看起来更像是无知的意淫。然而，理想还是要有的，万一真的实现了呢。</p>
<p>希望自己再今后的生活中，不被现实的压力所打倒，不被灯红酒绿所迷惑，勿忘初心，继续前行。</p>
]]></content>
      
        <categories>
            
            <category> 杂谈 </category>
            
        </categories>
        
        
        <tags>
            
            <tag> 思考，感悟 </tag>
            
        </tags>
        
    </entry>
    
    <entry>
      <title><![CDATA[byebye-csdn]]></title>
      <url>/2017/05/27/byebye-csdn/</url>
      <content type="html"><![CDATA[<p>鉴于CSDN的广告实在是忍无可忍了，故将博客迁至此处。</p>
<p>原CSDN博客不再做更新，仍能访问，地址见站点概览。</p>
<p>最后，很高兴有了一个新的博客，新的界面，新的风格，everythind is new!<br>ps:赠桌面一张<br><img src="https://ooo.0o0.ooo/2017/05/27/5929919aa66d3.jpg" alt="desktop.jpg"></p>
]]></content>
      
        <categories>
            
            <category> 杂谈 </category>
            
        </categories>
        
        
        <tags>
            
            <tag> 碎碎念 </tag>
            
        </tags>
        
    </entry>
    
    <entry>
      <title><![CDATA[Hello World]]></title>
      <url>/2017/05/25/hello-world/</url>
      <content type="html"><![CDATA[<p>Welcome to <a href="https://hexo.io/" target="_blank" rel="external">Hexo</a>! This is your very first post. Check <a href="https://hexo.io/docs/" target="_blank" rel="external">documentation</a> for more info. If you get any problems when using Hexo, you can find the answer in <a href="https://hexo.io/docs/troubleshooting.html" target="_blank" rel="external">troubleshooting</a> or you can ask me on <a href="https://github.com/hexojs/hexo/issues" target="_blank" rel="external">GitHub</a>.</p>
<h2 id="Quick-Start"><a href="#Quick-Start" class="headerlink" title="Quick Start"></a>Quick Start</h2><h3 id="Create-a-new-post"><a href="#Create-a-new-post" class="headerlink" title="Create a new post"></a>Create a new post</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ hexo new <span class="string">"My New Post"</span></div></pre></td></tr></table></figure>
<p>More info: <a href="https://hexo.io/docs/writing.html" target="_blank" rel="external">Writing</a></p>
<h3 id="Run-server"><a href="#Run-server" class="headerlink" title="Run server"></a>Run server</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ hexo server</div></pre></td></tr></table></figure>
<p>More info: <a href="https://hexo.io/docs/server.html" target="_blank" rel="external">Server</a></p>
<h3 id="Generate-static-files"><a href="#Generate-static-files" class="headerlink" title="Generate static files"></a>Generate static files</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ hexo generate</div></pre></td></tr></table></figure>
<p>More info: <a href="https://hexo.io/docs/generating.html" target="_blank" rel="external">Generating</a></p>
<h3 id="Deploy-to-remote-sites"><a href="#Deploy-to-remote-sites" class="headerlink" title="Deploy to remote sites"></a>Deploy to remote sites</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ hexo deploy</div></pre></td></tr></table></figure>
<p>More info: <a href="https://hexo.io/docs/deployment.html" target="_blank" rel="external">Deployment</a></p>
]]></content>
      
        
    </entry>
    
  
  
    
    <entry>
      <title><![CDATA[关于李老师的博客]]></title>
      <url>/about/index.html</url>
      <content type="html"></content>
    </entry>
    
    <entry>
      <title><![CDATA[文章分类]]></title>
      <url>/categories/index.html</url>
      <content type="html"></content>
    </entry>
    
    <entry>
      <title><![CDATA[文章标签]]></title>
      <url>/tags/index.html</url>
      <content type="html"></content>
    </entry>
    
  
</search>
